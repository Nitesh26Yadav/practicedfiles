import requests
import json

conn = "https://pfmfnfh7lrtqicmjeu4nmswqui0ikdwa.lambda-url.us-east-1.on.aws/query"
# print(conn)
# query1 = {

# 		"Instance":"veritra",

# 		"DB":"RSA_CentMark",

# 		"Proc":"ap_get_rule_top_n_shoppers",

# 		"Args":"0"

# 	}

# query = f"exec ap_update_rule  'ruletype','name', 'subruletype', 'nooffer', 'frequency',1"
# query = "exec ap_get_rule 0"
query = "exec ap_get_rule_top_n_shoppers 0"


def Accessdbdata(conn,query):
		
	try:
		filterdata = []
		for x in query.split():
			if x == 'exec':
				pass
			elif x != 'exec':
				filterdata.append(x)
		proc_name = filterdata[0]
		data = filterdata[1:]
		
		args_name = str(data).replace('[','').replace(']','')
		body = {

		"Instance":"veritra",

		"DB":"RSA_CentMark",

		"Proc":proc_name,

		"Args":args_name

	}
		response = requests.post(conn,json = body)
		rules = json.loads(response.text)
		
		return rules['Message']
	except:
		return False
data = Accessdbdata(conn,query)


print(data)
















# def AccessDBData(conn, query):
#     cursor = conn.cursor(as_dict=True)
#     log.info(f"--Running query - {query}")
#     try:
#         # cursor.execute("update brand set name = 'McD' OUTPUT inserted.id where company_id = 2;")
#         cursor.execute(f"{query};")
#         row = cursor.fetchall()
#         if cursor.rowcount > 0:
#             conn.commit()
#             log.info(f"--Query results - {row}")
#             # row is list of results(json)
#             return row
#         return []
#     except pymssql.OperationalError as e:
#         log.error(f"--DB insertion/update/delete Error - {e}")
#         return False
#     except pymssql.Error as e:
#         log.error(f"--DB insertion/update/delete Error - {e}")
#         cursor.execute("ROLLBACK;")
#         conn.rollback()
#         return False
