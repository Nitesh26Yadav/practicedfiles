# import requests
# import os


# guid = 'F36DF97E-F80C-44C1-A64F-6BE5D07FD298'
# UID = 1
# RuleId = 1

# query = f"exec ap_get_rule '{guid}', {UID}"
# # query = f"exec ap_get_rule_stores {RuleId}"


# conn = os.environ.get("API")
# def Accessdbdata(conn,query):

# 	try:
# 		filterdata = query.split()
# 		proc_name = filterdata[1]

# 		name = ""
# 		args_name = name.join(filterdata[2:])

# 		body = {

# 		"Instance":"veritra",

# 		"DB":"RSA_CentMark",

# 		"Proc": proc_name,

# 		"Args": args_name

# 		}

# 		response = requests.post(conn,json = body)
# 		rules = response.json()
# 		return rules['Message']

# 	except:
# 		return False

# data = Accessdbdata(conn,query)
# print(data)

# [{"department_no": "13", "order_item_id": "465748", "order_id": "24389", "item_type": "", "sku": "7003837286", "product_id": "2846757", "name": "Best Choice Large Eggs 18 pack", "qty": "1", "old_qty": "1", "price": "6.19", "unit_price": "0", "special_price": "6.19", "final_price": "6.19", "api_final_price": "6.19", "row_total": "6.19", "api_row_total": "6.19", "coupon_code": "", "coupon_discount": "0", "final_total": "6.19", "api_final_total": "6.19", "variations": "", "custom_options": "", "item_note": "", "picker_notes": "", "item_status": "2", "substituted_for_item": "0", "substituted_for_item_UPC": "", "is_delete": "0", "aisle_number": "BST-CH GRD A 18P EGG", "substitution": null, "mark_as_age_restricted_department": "0", "is_weighted_item": "0", "old_weight": "0", "weight": "0", "added_on": "2023-02-02 05:24:17", "department_id": "3238", "department_tax": "0.59", "units_per_unit": "1.00", "calc_type": "", "weighted_price": "0.00", "custom_options_arr": null, "item_added_type": null, "allow_ebt": "0", "api_department_tax": "9.50", "api_department_id": "3238", "is_mealkit": "0", "like_code": "0", "product_upc": "", "CouponCategoryId": "0", "coupon_amount": "0", "coupon_title": "", "coupon_promo_code": ""}, {"department_no": "22", "order_item_id": "465749", "order_id": "24389", "item_type": "", "sku": "4900005011", "product_id": "2860264", "name": "Diet Coke Soda 2 L", "qty": "8", "old_qty": "8", "price": "1.79", "unit_price": "0", "special_price": "1.79", "final_price": "1.79", "api_final_price": "1.79", "row_total": "14.32", "api_row_total": "14.32", "coupon_code": "", "coupon_discount": "0", "final_total": "14.32", "api_final_total": "14.32", "variations": "", "custom_options": "", "item_note": "", "picker_notes": "", "item_status": "2", "substituted_for_item": "0", "substituted_for_item_UPC": "", "is_delete": "0", "aisle_number": "DIET COKE 2LTR", "substitution": null, "mark_as_age_restricted_department": "0", "is_weighted_item": "0", "old_weight": "0", "weight": "0", "added_on": "2023-02-02 05:24:17", "department_id": "3259", "department_tax": "1.36", "units_per_unit": "1.00", "calc_type": null, "weighted_price": "0.00", "custom_options_arr": null, "item_added_type": null, "allow_ebt": "0", "api_department_tax": "9.50", "api_department_id": "3259", "is_mealkit": "0", "like_code": "0", "product_upc": "", "CouponCategoryId": "0", "coupon_amount": "0", "coupon_title": "", "coupon_promo_code": ""}, {"department_no": "30", "order_item_id": "465750", "order_id": "24389", "item_type": "", "sku": "7003861881", "product_id": "3008794", "name": "Best Choice FRZR POP MOD", "qty": "1", "old_qty": "1", "price": "3.99", "unit_price": "0", "special_price": "3.99", "final_price": "3.99", "api_final_price": "3.99", "row_total": "3.99", "api_row_total": "3.99", "coupon_code": "", "coupon_discount": "0", "final_total": "3.99", "api_final_total": "3.99", "variations": "", "custom_options": "", "item_note": "", "picker_notes": "", "item_status": "2", "substituted_for_item": "0", "substituted_for_item_UPC": "", "is_delete": "0", "aisle_number": "B-CH FREEZER POPS 36/2", "substitution": null, "mark_as_age_restricted_department": "0", "is_weighted_item": "0", "old_weight": "0", "weight": "0", "added_on": "2023-02-02 05:24:17", "department_id": "3255", "department_tax": "0.38", "units_per_unit": "1.00", "calc_type": null, "weighted_price": "0.00", "custom_options_arr": null, "item_added_type": null, "allow_ebt": "0", "api_department_tax": "9.50", "api_department_id": "3255", "is_mealkit": "0", "like_code": "0", "product_upc": "", "CouponCategoryId": "0", "coupon_amount": "0", "coupon_title": "", "coupon_promo_code": ""}, {"department_no": "30", "order_item_id": "465751", "order_id": "24389", "item_type": "", "sku": "7003858505", "product_id": "3878958", "name": "POTATOES, 10LB RUSSET", "qty": "1", "old_qty": "1", "price": "6.59", "unit_price": "0", "special_price": "6.59", "final_price": "6.59", "api_final_price": "6.59", "row_total": "6.59", "api_row_total": "6.59", "coupon_code": "", "coupon_discount": "0", "final_total": "6.59", "api_final_total": "6.59", "variations": "", "custom_options": "", "item_note": "", "picker_notes": "", "item_status": "2", "substituted_for_item": "0", "substituted_for_item_UPC": "", "is_delete": "0", "aisle_number": "1", "substitution": null, "mark_as_age_restricted_department": "0", "is_weighted_item": "0", "old_weight": "0", "weight": "0", "added_on": "2023-02-02 05:24:17", "department_id": "3255", "department_tax": "0.63", "units_per_unit": "1.00", "calc_type": null, "weighted_price": "0.00", "custom_options_arr": null, "item_added_type": null, "allow_ebt": "0", "api_department_tax": "9.50", "api_department_id": "3255", "is_mealkit": "0", "like_code": "0", "product_upc": "", "CouponCategoryId": "0", "coupon_amount": "0", "coupon_title": "", "coupon_promo_code": ""}, {"department_no": "40", "order_item_id": "465752", "order_id": "24389", "item_type": "", "sku": "20114700000", "product_id": "3876916", "name": "80% LEAN  GROUND CHUCK 10# TUBE", "qty": "10", "old_qty": "1", "price": "2.99", "unit_price": "2.99", "special_price": "2.99", "final_price": "2.99", "api_final_price": "2.99", "row_total": "29.9", "api_row_total": "29.9", "coupon_code": "", "coupon_discount": "0", "final_total": "2.99", "api_final_total": "29.9", "variations": "", "custom_options": "", "item_note": "", "picker_notes": "", "item_status": "2", "substituted_for_item": "0", "substituted_for_item_UPC": "", "is_delete": "0", "aisle_number": "15", "substitution": null, "mark_as_age_restricted_department": "0", "is_weighted_item": "1", "old_weight": "0", "weight": "0.05", "added_on": "2023-02-02 05:24:17", "department_id": "3249", "department_tax": "2.84", "units_per_unit": "1.00", "calc_type": null, "weighted_price": "0.00", "custom_options_arr": null, "item_added_type": null, "allow_ebt": "0", "api_department_tax": "9.50", "api_department_id": "3249", "is_mealkit": "0", "like_code": "0", "product_upc": "", "CouponCategoryId": "0", "coupon_amount": "0", "coupon_title": "", "coupon_promo_code": ""}, {"department_no": "41", "order_item_id": "465753", "order_id": "24389", "item_type": "", "sku": "20201200000", "product_id": "3899276", "name": "FP BONE IN PORK STEAK", "qty": "2", "old_qty": "1", "price": "1.99", "unit_price": "1.99", "special_price": "1.99", "final_price": "1.99", "api_final_price": "1.99", "row_total": "3.98", "api_row_total": "3.98", "coupon_code": "", "coupon_discount": "0", "final_total": "1.99", "api_final_total": "3.98", "variations": "", "custom_options": "", "item_note": "", "picker_notes": "", "item_status": "2", "substituted_for_item": "0", "substituted_for_item_UPC": "", "is_delete": "0", "aisle_number": "FP BONE IN PORK STEAK", "substitution": null, "mark_as_age_restricted_department": "0", "is_weighted_item": "1", "old_weight": "0", "weight": "0", "added_on": "2023-02-02 05:24:17", "department_id": "3250", "department_tax": "0.38", "units_per_unit": "1.00", "calc_type": null, "weighted_price": "0.00", "custom_options_arr": null, "item_added_type": null, "allow_ebt": "0", "api_department_tax": "9.50", "api_department_id": "3250", "is_mealkit": "0", "like_code": "0", "product_upc": "", "CouponCategoryId": "0", "coupon_amount": "0", "coupon_title": "", "coupon_promo_code": ""}, {"department_no": "42", "order_item_id": "465754", "order_id": "24389", "item_type": "", "sku": "7562065074", "product_id": "2859256", "name": "Gold Leaf Fresh Chicken Leg Quarters, 10 lb.", "qty": "1", "old_qty": "1", "price": "6.89", "unit_price": "0", "special_price": "6.89", "final_price": "6.89", "api_final_price": "6.89", "row_total": "6.89", "api_row_total": "6.89", "coupon_code": "", "coupon_discount": "0", "final_total": "6.89", "api_final_total": "6.89", "variations": "", "custom_options": "", "item_note": "", "picker_notes": "", "item_status": "2", "substituted_for_item": "0", "substituted_for_item_UPC": "", "is_delete": "0", "aisle_number": "GOLD LEAF LEG QTR 10 LB.", "substitution": null, "mark_as_age_restricted_department": "0", "is_weighted_item": "0", "old_weight": "0", "weight": "0", "added_on": "2023-02-02 05:24:17", "department_id": "3251", "department_tax": "0.65", "units_per_unit": "1.00", "calc_type": null, "weighted_price": "0.00", "custom_options_arr": "\"[{\\\"option_id\\\":\\\"2646513\\\",\\\"price\\\":\\\"0.00\\\",\\\"label\\\":\\\"Allow Substitution?\\\",\\\"is_add_option_price\\\":\\\"1\\\",\\\"id\\\":\\\"5316486\\\",\\\"value\\\":\\\"Yes\\\"}]\"", "item_added_type": null, "allow_ebt": "0", "api_department_tax": "9.50", "api_department_id": "3251", "is_mealkit": "0", "like_code": "0", "product_upc": "", "CouponCategoryId": "0", "coupon_amount": "0", "coupon_title": "", "coupon_promo_code": ""}, {"department_no": "30", "order_item_id": "465755", "order_id": "24389", "item_type": "", "sku": "3338366401", "product_id": "3854842", "name": "2LB WHOLE CARROTS", "qty": "1", "old_qty": "1", "price": "1.99", "unit_price": "0", "special_price": "1.99", "final_price": "1.99", "api_final_price": "1.99", "row_total": "1.99", "api_row_total": "1.99", "coupon_code": "", "coupon_discount": "0", "final_total": "1.99", "api_final_total": "1.99", "variations": "", "custom_options": "", "item_note": "", "picker_notes": "", "item_status": "2", "substituted_for_item": "0", "substituted_for_item_UPC": "", "is_delete": "0", "aisle_number": "2LB WHOLE CARROTS", "substitution": null, "mark_as_age_restricted_department": "0", "is_weighted_item": "0", "old_weight": "0", "weight": "0", "added_on": "2023-02-02 05:24:17", "department_id": "3255", "department_tax": "0.19", "units_per_unit": "1.00", "calc_type": null, "weighted_price": "0.00", "custom_options_arr": null, "item_added_type": null, "allow_ebt": "0", "api_department_tax": "9.50", "api_department_id": "3255", "is_mealkit": "0", "like_code": "0", "product_upc": "", "CouponCategoryId": "0", "coupon_amount": "0", "coupon_title": "", "coupon_promo_code": ""}, {"department_no": "30", "order_item_id": "465756", "order_id": "24389", "item_type": "", "sku": "4166", "product_id": "1798125", "name": "ONIONS, YELLOW", "qty": "3", "old_qty": "3", "price": "6.76", "unit_price": "1.69", "special_price": "6.76", "final_price": "6.76", "api_final_price": "1.69", "row_total": "20.28", "api_row_total": "2.96", "coupon_code": "", "coupon_discount": "0", "final_total": "20.28", "api_final_total": "2.96", "variations": "", "custom_options": "", "item_note": "", "picker_notes": "", "item_status": "2", "substituted_for_item": "0", "substituted_for_item_UPC": "", "is_delete": "0", "aisle_number": "ONIONS  SUNION", "substitution": null, "mark_as_age_restricted_department": "0", "is_weighted_item": "1", "old_weight": "12", "weight": "1.75", "added_on": "2023-02-02 05:24:17", "department_id": "3255", "department_tax": "0.28", "units_per_unit": "0.25", "calc_type": "D", "weighted_price": "1.69", "custom_options_arr": null, "item_added_type": null, "allow_ebt": "0", "api_department_tax": "9.50", "api_department_id": "3255", "is_mealkit": "0", "like_code": "0", "product_upc": "", "CouponCategoryId": "0", "coupon_amount": "0", "coupon_title": "", "coupon_promo_code": ""}, {"department_no": "10", "order_item_id": "465757", "order_id": "24389", "item_type": "", "sku": "7003832080", "product_id": "2853318", "name": "AL SAVE APPLE JELLY", "qty": "1", "old_qty": "1", "price": "3.29", "unit_price": "0", "special_price": "3.29", "final_price": "3.29", "api_final_price": "3.29", "row_total": "3.29", "api_row_total": "3.29", "coupon_code": "", "coupon_discount": "0", "final_total": "3.29", "api_final_total": "3.29", "variations": "", "custom_options": "", "item_note": "", "picker_notes": "", "item_status": "2", "substituted_for_item": "0", "substituted_for_item_UPC": "", "is_delete": "0", "aisle_number": "AL SAVE APPLE JELLY 32 OZ", "substitution": null, "mark_as_age_restricted_department": "0", "is_weighted_item": "0", "old_weight": "0", "weight": "0", "added_on": "2023-02-02 05:24:17", "department_id": "3245", "department_tax": "0.31", "units_per_unit": "1.00", "calc_type": null, "weighted_price": "0.00", "custom_options_arr": null, "item_added_type": null, "allow_ebt": "0", "api_department_tax": "9.50", "api_department_id": "3245", "is_mealkit": "0", "like_code": "0", "product_upc": "", "CouponCategoryId": "0", "coupon_amount": "0", "coupon_title": "", "coupon_promo_code": ""}, {"department_no": "10", "order_item_id": "465758", "order_id": "24389", "item_type": "", "sku": "7003838028", "product_id": "2853674", "name": "AL SAVE PNT BTR CRMY", "qty": "1", "old_qty": "1", "price": "6.79", "unit_price": "6.79", "special_price": "6.79", "final_price": "6.79", "api_final_price": "6.79", "row_total": "6.79", "api_row_total": "6.79", "coupon_code": "", "coupon_discount": "0", "final_total": "6.79", "api_final_total": "6.79", "variations": "", "custom_options": "", "item_note": "", "picker_notes": "Substituted with 4 16 oz. ", "item_status": "2", "substituted_for_item": "0", "substituted_for_item_UPC": "", "is_delete": "0", "aisle_number": "AL SAVE PNUT BTR CRMY 64 OZ", "substitution": null, "mark_as_age_restricted_department": "0", "is_weighted_item": "0", "old_weight": "0", "weight": "0", "added_on": "2023-02-02 05:24:17", "department_id": "3245", "department_tax": "0.65", "units_per_unit": "1.00", "calc_type": null, "weighted_price": "0.00", "custom_options_arr": null, "item_added_type": null, "allow_ebt": "0", "api_department_tax": "9.50", "api_department_id": "3245", "is_mealkit": "0", "like_code": "0", "product_upc": "", "CouponCategoryId": "0", "coupon_amount": "0", "coupon_title": "", "coupon_promo_code": ""}, {"department_no": "10", "order_item_id": "465759", "order_id": "24389", "item_type": "", "sku": "4240031864", "product_id": "2851882", "name": "Malt-O-Meal Fruity Dyno-Bites Cereal 35 oz. Bag", "qty": "1", "old_qty": "1", "price": "3.99", "unit_price": "3.99", "special_price": "3.99", "final_price": "3.99", "api_final_price": "3.99", "row_total": "3.99", "api_row_total": "3.99", "coupon_code": "", "coupon_discount": "0", "final_total": "3.99", "api_final_total": "3.99", "variations": "", "custom_options": "", "item_note": "", "picker_notes": "We don\u2019t have 35oz bags and the 25oz is 5.99 I\u2019m not sure what\u2019s wrong with the pricing but I gave you the 25oz for 3.99", "item_status": "2", "substituted_for_item": "0", "substituted_for_item_UPC": "", "is_delete": "0", "aisle_number": "MOM DYNO BITES 25 OZ", "substitution": null, "mark_as_age_restricted_department": "0", "is_weighted_item": "0", "old_weight": "0", "weight": "0", "added_on": "2023-02-02 05:24:17", "department_id": "3245", "department_tax": "0.38", "units_per_unit": "1.00", "calc_type": null, "weighted_price": "0.00", "custom_options_arr": null, "item_added_type": null, "allow_ebt": "0", "api_department_tax": "9.50", "api_department_id": "3245", "is_mealkit": "0", "like_code": "0", "product_upc": "", "CouponCategoryId": "0", "coupon_amount": "0", "coupon_title": "", "coupon_promo_code": ""}, {"department_no": "10", "order_item_id": "465760", "order_id": "24389", "item_type": "", "sku": "4240029324", "product_id": "2851880", "name": "Malt-O-Meal Chocolatey Chip Cookie Bites Cereal 21 oz. ZIP-PAK", "qty": "1", "old_qty": "1", "price": "5.99", "unit_price": "0", "special_price": "5.99", "final_price": "5.99", "api_final_price": "5.99", "row_total": "5.99", "api_row_total": "5.99", "coupon_code": "", "coupon_discount": "0", "final_total": "5.99", "api_final_total": "5.99", "variations": "", "custom_options": "", "item_note": "", "picker_notes": "", "item_status": "2", "substituted_for_item": "0", "substituted_for_item_UPC": "", "is_delete": "0", "aisle_number": "MOM COOKIE BIT FAM SIZ 21 OZ", "substitution": null, "mark_as_age_restricted_department": "0", "is_weighted_item": "0", "old_weight": "0", "weight": "0", "added_on": "2023-02-02 05:24:17", "department_id": "3245", "department_tax": "0.57", "units_per_unit": "1.00", "calc_type": null, "weighted_price": "0.00", "custom_options_arr": null, "item_added_type": null, "allow_ebt": "0", "api_department_tax": "9.50", "api_department_id": "3245", "is_mealkit": "0", "like_code": "0", "product_upc": "", "CouponCategoryId": "0", "coupon_amount": "0", "coupon_title": "", "coupon_promo_code": ""}, {"department_no": "11", "order_item_id": "465761", "order_id": "24389", "item_type": "", "sku": "7003865302", "product_id": "2857575", "name": "Best Choice Extra Soft Double Roll Bath Tissue 6-Roll 6 rl", "qty": "1", "old_qty": "1", "price": "4.95", "unit_price": "0", "special_price": "4.95", "final_price": "4.95", "api_final_price": "4.95", "row_total": "4.95", "api_row_total": "4.95", "coupon_code": "", "coupon_discount": "0", "final_total": "4.95", "api_final_total": "4.95", "variations": "", "custom_options": "", "item_note": "", "picker_notes": "", "item_status": "2", "substituted_for_item": "0", "substituted_for_item_UPC": "", "is_delete": "0", "aisle_number": "BST-CH XSFT 6DR BATH 6 RL", "substitution": null, "mark_as_age_restricted_department": "0", "is_weighted_item": "0", "old_weight": "0", "weight": "0", "added_on": "2023-02-02 05:24:17", "department_id": "3247", "department_tax": "0.47", "units_per_unit": "1.00", "calc_type": null, "weighted_price": "0.00", "custom_options_arr": null, "item_added_type": null, "allow_ebt": "0", "api_department_tax": "9.50", "api_department_id": "3247", "is_mealkit": "0", "like_code": "0", "product_upc": "", "CouponCategoryId": "0", "coupon_amount": "0", "coupon_title": "", "coupon_promo_code": ""}]


# # data = {'order_id': '24389', 'order_number': 'ORD024389', 'rsa_client_id': '181', 'store_id': '113', 'clientStoreId': '1', 'updated_on': '2023-02-02 05:24:21', 'transaction_total_amount': '109.00', 'transaction_grand_total': '109.00', 'tip_amount': '0.00', 'api_order_fee_amount': '0.00', 'subtotal_amount': '101.82', 'transaction_tax_amount': '9.68', 'order_placed_on': '2023-02-02 05:24:17', 'payment_method': 'cc', 'payment_method_name': 'Credit Card', 'shipping_method': 'store_pickup', 'shipping_method_name': 'Store Pickup', 'customer_id': '10160', 'payment_status': '2', 'payment_status_name': 'Completed', 'order_status': '7', 'order_status_name': 'Completed', 'store_notes': 'Thank you!', 'api_cost_plus_fees_amount': '0.00', 'api_credit_card_fee_amount': '0.00', 'total_discount_amount': '2.50', 'shipping_date': '2023-02-02', 'shipping_time': '11:00 AM - 12:00 PM', 'shipping_day': 'Thursday', 'department_tax_amount': '8.58', 'member_number': '44674934368', 'order_items': [{'department_no': '13', 'order_item_id': '465748', 'order_id': '24389', 'item_type': '', 'sku': '7003837286', 'product_id': '2846757', 'name': 'Best Choice Large Eggs 18 pack', 'qty': '1', 'old_qty': '1', 'price': '6.19', 'unit_price': '0', 'special_price': '6.19', 'final_price': '6.19', 'api_final_price': '6.19', 'row_total': '6.19', 'api_row_total': '6.19', 'coupon_code': '', 'coupon_discount': '0', 'final_total': '6.19', 'api_final_total': '6.19', 'variations': '', 'custom_options': '', 'item_note': '', 'picker_notes': '', 'item_status': '2', 'substituted_for_item': '0', 'substituted_for_item_UPC': '', 'is_delete': '0', 'aisle_number': 'BST-CH GRD A 18P EGG', 'substitution': None, 'mark_as_age_restricted_department': '0', 'is_weighted_item': '0', 'old_weight': '0', 'weight': '0', 'added_on': '2023-02-02 05:24:17', 'department_id': '3238', 'department_tax': '0.59', 'units_per_unit': '1.00', 'calc_type': '', 'weighted_price': '0.00', 'custom_options_arr': None, 'item_added_type': None, 'allow_ebt': '0', 'api_department_tax': '9.50', 'api_department_id': '3238', 'is_mealkit': '0', 'like_code': '0', 'product_upc': '', 'CouponCategoryId': '0', 'coupon_amount': '0', 'coupon_title': '', 'coupon_promo_code': ''}, {'department_no': '22', 'order_item_id': '465749', 'order_id': '24389', 'item_type': '', 'sku': '4900005011', 'product_id': '2860264', 'name': 'Diet Coke Soda 2 L', 'qty': '8', 'old_qty': '8', 'price': '1.79', 'unit_price': '0', 'special_price': '1.79', 'final_price': '1.79', 'api_final_price': '1.79', 'row_total': '14.32', 'api_row_total': '14.32', 'coupon_code': '', 'coupon_discount': '0', 'final_total': '14.32', 'api_final_total': '14.32', 'variations': '', 'custom_options': '', 'item_note': '', 'picker_notes': '', 'item_status': '2', 'substituted_for_item': '0', 'substituted_for_item_UPC': '', 'is_delete': '0', 'aisle_number': 'DIET COKE 2LTR', 'substitution': None, 'mark_as_age_restricted_department': '0', 'is_weighted_item': '0', 'old_weight': '0', 'weight': '0', 'added_on': '2023-02-02 05:24:17', 'department_id': '3259', 'department_tax': '1.36', 'units_per_unit': '1.00', 'calc_type': None, 'weighted_price': '0.00', 'custom_options_arr': None, 'item_added_type': None, 'allow_ebt': '0', 'api_department_tax': '9.50', 'api_department_id': '3259', 'is_mealkit': '0', 'like_code': '0', 'product_upc': '', 'CouponCategoryId': '0', 'coupon_amount': '0', 'coupon_title': '', 'coupon_promo_code': ''}, {'department_no': '30', 'order_item_id': '465750', 'order_id': '24389', 'item_type': '', 'sku': '7003861881', 'product_id': '3008794', 'name': 'Best Choice FRZR POP MOD', 'qty': '1', 'old_qty': '1', 'price': '3.99', 'unit_price': '0', 'special_price': '3.99', 'final_price': '3.99', 'api_final_price': '3.99', 'row_total': '3.99', 'api_row_total': '3.99', 'coupon_code': '', 'coupon_discount': '0', 'final_total': '3.99', 'api_final_total': '3.99', 'variations': '', 'custom_options': '', 'item_note': '', 'picker_notes': '', 'item_status': '2', 'substituted_for_item': '0', 'substituted_for_item_UPC': '', 'is_delete': '0', 'aisle_number': 'B-CH FREEZER POPS 36/2', 'substitution': None, 'mark_as_age_restricted_department': '0', 'is_weighted_item': '0', 'old_weight': '0', 'weight': '0', 'added_on': '2023-02-02 05:24:17', 'department_id': '3255', 'department_tax': '0.38', 'units_per_unit': '1.00', 'calc_type': None, 'weighted_price': '0.00', 'custom_options_arr': None, 'item_added_type': None, 'allow_ebt': '0', 'api_department_tax': '9.50', 'api_department_id': '3255', 'is_mealkit': '0', 'like_code': '0', 'product_upc': '', 'CouponCategoryId': '0', 'coupon_amount': '0', 'coupon_title': '', 'coupon_promo_code': ''}, {'department_no': '30', 'order_item_id': '465751', 'order_id': '24389', 'item_type': '', 'sku': '7003858505', 'product_id': '3878958', 'name': 'POTATOES, 10LB RUSSET', 'qty': '1', 'old_qty': '1', 'price': '6.59', 'unit_price': '0', 'special_price': '6.59', 'final_price': '6.59', 'api_final_price': '6.59', 'row_total': '6.59', 'api_row_total': '6.59', 'coupon_code': '', 'coupon_discount': '0', 'final_total': '6.59', 'api_final_total': '6.59', 'variations': '', 'custom_options': '', 'item_note': '', 'picker_notes': '', 'item_status': '2', 'substituted_for_item': '0', 'substituted_for_item_UPC': '', 'is_delete': '0', 'aisle_number': '1', 'substitution': None, 'mark_as_age_restricted_department': '0', 'is_weighted_item': '0', 'old_weight': '0', 'weight': '0', 'added_on': '2023-02-02 05:24:17', 'department_id': '3255', 'department_tax': '0.63', 'units_per_unit': '1.00', 'calc_type': None, 'weighted_price': '0.00', 'custom_options_arr': None, 'item_added_type': None, 'allow_ebt': '0', 'api_department_tax': '9.50', 'api_department_id': '3255', 'is_mealkit': '0', 'like_code': '0', 'product_upc': '', 'CouponCategoryId': '0', 'coupon_amount': '0', 'coupon_title': '', 'coupon_promo_code': ''}, {'department_no': '40', 'order_item_id': '465752', 'order_id': '24389', 'item_type': '', 'sku': '20114700000', 'product_id': '3876916', 'name': '80% LEAN  GROUND CHUCK 10# TUBE', 'qty': '10', 'old_qty': '1', 'price': '2.99', 'unit_price': '2.99', 'special_price': '2.99', 'final_price': '2.99', 'api_final_price': '2.99', 'row_total': '29.9', 'api_row_total': '29.9', 'coupon_code': '', 'coupon_discount': '0', 'final_total': '2.99', 'api_final_total': '29.9', 'variations': '', 'custom_options': '', 'item_note': '', 'picker_notes': '', 'item_status': '2', 'substituted_for_item': '0', 'substituted_for_item_UPC': '', 'is_delete': '0', 'aisle_number': '15', 'substitution': None, 'mark_as_age_restricted_department': '0', 'is_weighted_item': '1', 'old_weight': '0', 'weight': '0.05', 'added_on': '2023-02-02 05:24:17', 'department_id': '3249', 'department_tax': '2.84', 'units_per_unit': '1.00', 'calc_type': None, 'weighted_price': '0.00', 'custom_options_arr': None, 'item_added_type': None, 'allow_ebt': '0', 'api_department_tax': '9.50', 'api_department_id': '3249', 'is_mealkit': '0', 'like_code': '0', 'product_upc': '', 'CouponCategoryId': '0', 'coupon_amount': '0', 'coupon_title': '', 'coupon_promo_code': ''}, {'department_no': '41', 'order_item_id': '465753', 'order_id': '24389', 'item_type': '', 'sku': '20201200000', 'product_id': '3899276', 'name': 'FP BONE IN PORK STEAK', 'qty': '2', 'old_qty': '1', 'price': '1.99', 'unit_price': '1.99', 'special_price': '1.99', 'final_price': '1.99', 'api_final_price': '1.99', 'row_total': '3.98', 'api_row_total': '3.98', 'coupon_code': '', 'coupon_discount': '0', 'final_total': '1.99', 'api_final_total': '3.98', 'variations': '', 'custom_options': '', 'item_note': '', 'picker_notes': '', 'item_status': '2', 'substituted_for_item': '0', 'substituted_for_item_UPC': '', 'is_delete': '0', 'aisle_number': 'FP BONE IN PORK STEAK', 'substitution': None, 'mark_as_age_restricted_department': '0', 'is_weighted_item': '1', 'old_weight': '0', 'weight': '0', 'added_on': '2023-02-02 05:24:17', 'department_id': '3250', 'department_tax': '0.38', 'units_per_unit': '1.00', 'calc_type': None, 'weighted_price': '0.00', 'custom_options_arr': None, 'item_added_type': None, 'allow_ebt': '0', 'api_department_tax': '9.50', 'api_department_id': '3250', 'is_mealkit': '0', 'like_code': '0', 'product_upc': '', 'CouponCategoryId': '0', 'coupon_amount': '0', 'coupon_title': '', 'coupon_promo_code': ''}, {'department_no': '42', 'order_item_id': '465754', 'order_id': '24389', 'item_type': '', 'sku': '7562065074', 'product_id': '2859256', 'name': 'Gold Leaf Fresh Chicken Leg Quarters, 10 lb.', 'qty': '1', 'old_qty': '1', 'price': '6.89', 'unit_price': '0', 'special_price': '6.89', 'final_price': '6.89', 'api_final_price': '6.89', 'row_total': '6.89', 'api_row_total': '6.89', 'coupon_code': '', 'coupon_discount': '0', 'final_total': '6.89', 'api_final_total': '6.89', 'variations': '', 'custom_options': '', 'item_note': '', 'picker_notes': '', 'item_status': '2', 'substituted_for_item': '0', 'substituted_for_item_UPC': '', 'is_delete': '0', 'aisle_number': 'GOLD LEAF LEG QTR 10 LB.', 'substitution': None, 'mark_as_age_restricted_department': '0', 'is_weighted_item': '0', 'old_weight': '0', 'weight': '0', 'added_on': '2023-02-02 05:24:17', 'department_id': '3251', 'department_tax': '0.65', 'units_per_unit': '1.00', 'calc_type': None, 'weighted_price': '0.00', 'custom_options_arr': '"[{\\"option_id\\":\\"2646513\\",\\"price\\":\\"0.00\\",\\"label\\":\\"Allow Substitution?\\",\\"is_add_option_price\\":\\"1\\",\\"id\\":\\"5316486\\",\\"value\\":\\"Yes\\"}]"', 'item_added_type': None, 'allow_ebt': '0', 'api_department_tax': '9.50', 'api_department_id': '3251', 'is_mealkit': '0', 'like_code': '0', 'product_upc': '', 'CouponCategoryId': '0', 'coupon_amount': '0', 'coupon_title': '', 'coupon_promo_code': ''}, {'department_no': '30', 'order_item_id': '465755', 'order_id': '24389', 'item_type': '', 'sku': '3338366401', 'product_id': '3854842', 'name': '2LB WHOLE CARROTS', 'qty': '1', 'old_qty': '1', 'price': '1.99', 'unit_price': '0', 'special_price': '1.99', 'final_price': '1.99', 'api_final_price': '1.99', 'row_total': '1.99', 'api_row_total': '1.99', 'coupon_code': '', 'coupon_discount': '0', 'final_total': '1.99', 'api_final_total': '1.99', 'variations': '', 'custom_options': '', 'item_note': '', 'picker_notes': '', 'item_status': '2', 'substituted_for_item': '0', 'substituted_for_item_UPC': '', 'is_delete': '0', 'aisle_number': '2LB WHOLE CARROTS', 'substitution': None, 'mark_as_age_restricted_department': '0', 'is_weighted_item': '0', 'old_weight': '0', 'weight': '0', 'added_on': '2023-02-02 05:24:17', 'department_id': '3255', 'department_tax': '0.19', 'units_per_unit': '1.00', 'calc_type': None, 'weighted_price': '0.00', 'custom_options_arr': None, 'item_added_type': None, 'allow_ebt': '0', 'api_department_tax': '9.50', 'api_department_id': '3255', 'is_mealkit': '0', 'like_code': '0', 'product_upc': '', 'CouponCategoryId': '0', 'coupon_amount': '0', 'coupon_title': '', 'coupon_promo_code': ''}, {'department_no': '30', 'order_item_id': '465756', 'order_id': '24389', 'item_type': '', 'sku': '4166', 'product_id': '1798125', 'name': 'ONIONS, YELLOW', 'qty': '3', 'old_qty': '3', 'price': '6.76', 'unit_price': '1.69', 'special_price': '6.76', 'final_price': '6.76', 'api_final_price': '1.69', 'row_total': '20.28', 'api_row_total': '2.96', 'coupon_code': '', 'coupon_discount': '0', 'final_total': '20.28', 'api_final_total': '2.96', 'variations': '', 'custom_options': '', 'item_note': '', 'picker_notes': '', 'item_status': '2', 'substituted_for_item': '0', 'substituted_for_item_UPC': '', 'is_delete': '0', 'aisle_number': 'ONIONS  SUNION', 'substitution': None, 'mark_as_age_restricted_department': '0', 'is_weighted_item': '1', 'old_weight': '12', 'weight': '1.75', 'added_on': '2023-02-02 05:24:17', 'department_id': '3255', 'department_tax': '0.28', 'units_per_unit': '0.25', 'calc_type': 'D', 'weighted_price': '1.69', 'custom_options_arr': None, 'item_added_type': None, 'allow_ebt': '0', 'api_department_tax': '9.50', 'api_department_id': '3255', 'is_mealkit': '0', 'like_code': '0', 'product_upc': '', 'CouponCategoryId': '0', 'coupon_amount': '0', 'coupon_title': '', 'coupon_promo_code': ''}, {'department_no': '10', 'order_item_id': '465757', 'order_id': '24389', 'item_type': '', 'sku': '7003832080', 'product_id': '2853318', 'name': 'AL SAVE APPLE JELLY', 'qty': '1', 'old_qty': '1', 'price': '3.29', 'unit_price': '0', 'special_price': '3.29', 'final_price': '3.29', 'api_final_price': '3.29', 'row_total': '3.29', 'api_row_total': '3.29', 'coupon_code': '', 'coupon_discount': '0', 'final_total': '3.29', 'api_final_total': '3.29', 'variations': '', 'custom_options': '', 'item_note': '', 'picker_notes': '', 'item_status': '2', 'substituted_for_item': '0', 'substituted_for_item_UPC': '', 'is_delete': '0', 'aisle_number': 'AL SAVE APPLE JELLY 32 OZ', 'substitution': None, 'mark_as_age_restricted_department': '0', 'is_weighted_item': '0', 'old_weight': '0', 'weight': '0', 'added_on': '2023-02-02 05:24:17', 'department_id': '3245', 'department_tax': '0.31', 'units_per_unit': '1.00', 'calc_type': None, 'weighted_price': '0.00', 'custom_options_arr': None, 'item_added_type': None, 'allow_ebt': '0', 'api_department_tax': '9.50', 'api_department_id': '3245', 'is_mealkit': '0', 'like_code': '0', 'product_upc': '', 'CouponCategoryId': '0', 'coupon_amount': '0', 'coupon_title': '', 'coupon_promo_code': ''}, {'department_no': '10', 'order_item_id': '465758', 'order_id': '24389', 'item_type': '', 'sku': '7003838028', 'product_id': '2853674', 'name': 'AL SAVE PNT BTR CRMY', 'qty': '1', 'old_qty': '1', 'price': '6.79', 'unit_price': '6.79', 'special_price': '6.79', 'final_price': '6.79', 'api_final_price': '6.79', 'row_total': '6.79', 'api_row_total': '6.79', 'coupon_code': '', 'coupon_discount': '0', 'final_total': '6.79', 'api_final_total': '6.79', 'variations': '', 'custom_options': '', 'item_note': '', 'picker_notes': 'Substituted with 4 16 oz. ', 'item_status': '2', 'substituted_for_item': '0', 'substituted_for_item_UPC': '', 'is_delete': '0', 'aisle_number': 'AL SAVE PNUT BTR CRMY 64 OZ', 'substitution': None, 'mark_as_age_restricted_department': '0', 'is_weighted_item': '0', 'old_weight': '0', 'weight': '0', 'added_on': '2023-02-02 05:24:17', 'department_id': '3245', 'department_tax': '0.65', 'units_per_unit': '1.00', 'calc_type': None, 'weighted_price': '0.00', 'custom_options_arr': None, 'item_added_type': None, 'allow_ebt': '0', 'api_department_tax': '9.50', 'api_department_id': '3245', 'is_mealkit': '0', 'like_code': '0', 'product_upc': '', 'CouponCategoryId': '0', 'coupon_amount': '0', 'coupon_title': '', 'coupon_promo_code': ''}, {'department_no': '10', 'order_item_id': '465759', 'order_id': '24389', 'item_type': '', 'sku': '4240031864', 'product_id': '2851882', 'name': 'Malt-O-Meal Fruity Dyno-Bites Cereal 35 oz. Bag', 'qty': '1', 'old_qty': '1', 'price': '3.99', 'unit_price': '3.99', 'special_price': '3.99', 'final_price': '3.99', 'api_final_price': '3.99', 'row_total': '3.99', 'api_row_total': '3.99', 'coupon_code': '', 'coupon_discount': '0', 'final_total': '3.99', 'api_final_total': '3.99', 'variations': '', 'custom_options': '', 'item_note': '', 'picker_notes': 'We don�t have 35oz bags and the 25oz is 5.99 I�m not sure what�s wrong with the pricing but I gave you the 25oz for 3.99', 'item_status': '2', 'substituted_for_item': '0', 'substituted_for_item_UPC': '', 'is_delete': '0', 'aisle_number': 'MOM DYNO BITES 25 OZ', 'substitution': None, 'mark_as_age_restricted_department': '0', 'is_weighted_item': '0', 'old_weight': '0', 'weight': '0', 'added_on': '2023-02-02 05:24:17', 'department_id': '3245', 'department_tax': '0.38', 'units_per_unit': '1.00', 'calc_type': None, 'weighted_price': '0.00', 'custom_options_arr': None, 'item_added_type': None, 'allow_ebt': '0', 'api_department_tax': '9.50', 'api_department_id': '3245', 'is_mealkit': '0', 'like_code': '0', 'product_upc': '', 'CouponCategoryId': '0', 'coupon_amount': '0', 'coupon_title': '', 'coupon_promo_code': ''}, {'department_no': '10', 'order_item_id': '465760', 'order_id': '24389', 'item_type': '', 'sku': '4240029324', 'product_id': '2851880', 'name': 'Malt-O-Meal Chocolatey Chip Cookie Bites Cereal 21 oz. ZIP-PAK', 'qty': '1', 'old_qty': '1', 'price': '5.99', 'unit_price': '0', 'special_price': '5.99', 'final_price': '5.99', 'api_final_price': '5.99', 'row_total': '5.99', 'api_row_total': '5.99', 'coupon_code': '', 'coupon_discount': '0', 'final_total': '5.99', 'api_final_total': '5.99', 'variations': '', 'custom_options': '', 'item_note': '', 'picker_notes': '', 'item_status': '2', 'substituted_for_item': '0', 'substituted_for_item_UPC': '', 'is_delete': '0', 'aisle_number': 'MOM COOKIE BIT FAM SIZ 21 OZ', 'substitution': None, 'mark_as_age_restricted_department': '0', 'is_weighted_item': '0', 'old_weight': '0', 'weight': '0', 'added_on': '2023-02-02 05:24:17', 'department_id': '3245', 'department_tax': '0.57', 'units_per_unit': '1.00', 'calc_type': None, 'weighted_price': '0.00', 'custom_options_arr': None, 'item_added_type': None, 'allow_ebt': '0', 'api_department_tax': '9.50', 'api_department_id': '3245', 'is_mealkit': '0', 'like_code': '0', 'product_upc': '', 'CouponCategoryId': '0', 'coupon_amount': '0', 'coupon_title': '', 'coupon_promo_code': ''}, {'department_no': '11', 'order_item_id': '465761', 'order_id': '24389', 'item_type': '', 'sku': '7003865302', 'product_id': '2857575', 'name': 'Best Choice Extra Soft Double Roll Bath Tissue 6-Roll 6 rl', 'qty': '1', 'old_qty': '1', 'price': '4.95', 'unit_price': '0', 'special_price': '4.95', 'final_price': '4.95', 'api_final_price': '4.95', 'row_total': '4.95', 'api_row_total': '4.95', 'coupon_code': '', 'coupon_discount': '0', 'final_total': '4.95', 'api_final_total': '4.95', 'variations': '', 'custom_options': '', 'item_note': '', 'picker_notes': '', 'item_status': '2', 'substituted_for_item': '0', 'substituted_for_item_UPC': '', 'is_delete': '0', 'aisle_number': 'BST-CH XSFT 6DR BATH 6 RL', 'substitution': None, 'mark_as_age_restricted_department': '0', 'is_weighted_item': '0', 'old_weight': '0', 'weight': '0', 'added_on': '2023-02-02 05:24:17', 'department_id': '3247', 'department_tax': '0.47', 'units_per_unit': '1.00', 'calc_type': None, 'weighted_price': '0.00', 'custom_options_arr': None, 'item_added_type': None, 'allow_ebt': '0', 'api_department_tax': '9.50', 'api_department_id': '3247', 'is_mealkit': '0', 'like_code': '0', 'product_upc': '', 'CouponCategoryId': '0', 'coupon_amount': '0', 'coupon_title': '', 'coupon_promo_code': ''}], 'getCouponList': [{'sc_id': '29712', 'cart_id': '67660', 'order_id': '24389', 'coupon_id': '9721', 'title': '18 Pack Eggs - $2.50Best Choice Eggs - 1', 'promo_code': '979000009235', 'amount': '0', 'discount': '2.5', 'new_discount': '2.5', 'added_on': '2023-02-02 05:23:01', 'CouponCategoryId': '0', 'product_upc': ''}]}
import pandas as pd
import csv
import json
import requests


url = "https://okpricemart.grocerypundit.com/api/AogGetOrderDetailsToPOSFormat"
body = {
    "rsa_client_id": "181",
    "clientStoreId": "1",
    "member_number": "44674934368",
    "ecomOrderId": "24389"
}


def get_data(url, body):

    response = requests.post(url, json=body)
    rules = response.json()
    # result = rules['data']['order_items']
    result = rules['data']
    return result


data = get_data(url, body)
data1 = []
data1.append({
    "Transaction Date": "2023-02-02",
    "Transaction Time": "05:24:21",
    "Transaction ID": data["order_id"],
    "Record Type": "HDR",
    "Version": "",
    "Organization": "",
    "Loyality": data["member_number"],
    "Tax ID": "",
    "Tax ID State Code": "",
    "Transaction Status": "",
    "": ""
})
for i in data['order_items']:
    data1.append({
        "Transaction Date": "2023-02-02",
        "Transaction Time": "05:24:21",
        "Transaction ID": data["order_id"],
        "Record Type": "UPC",
        "Product Code": i['sku'],
        "Retail Type": "L",
        "Multiple": i['price'],
        "Price": i['price'],
        "Quantity": i['qty'],
        "Weight": i['weight'],
        "": ""
    }
    )
for i in data['getCouponList']:
    data1.append({
        "Transaction Date": "2023-02-02",
        "Transaction Time": "05:24:21",
        "Transaction ID": data["order_id"],
        "Record Type": "CPN",
        "Coupon Type": "",
        "Coupon code": "",
        "Amount": "",
        "Dept Code": "",
        "": "",
        "": "",
        "": ""
    }
    )

data1.append({
    "Transaction Date": "2023-02-02",
    "Transaction Time": "05:24:21",
    "Transaction ID": data["order_id"],
    "Record Type": "TND",
    "Media Code": data["payment_method_name"],
    "Account Number": "",
    "Tendered Amount": data["transaction_tax_amount"],
    "": "",
    "": "",
    "": "",
    "": ""

})

data1.append({
    "Transaction Date": "2023-02-02",
    "Transaction Time": "05:24:21",
    "Transaction ID": data["order_id"],
    "Record Type": "TAX",
    "Tax Code": "",
    "": "",
    "": "",
    "Tax Collected": data["transaction_tax_amount"],
    "": "",
    "": "",
    "": ""
}
)
count = len(data1)
# print(count)

data1.append({
    "Transaction Date": "2023-02-02",
    "Transaction Time": "05:24:21",
    "Transaction ID": data["order_id"],
    "Record Type": "FTR",
    "Detail Count": count-1,
    "": "",
    "Field3": "",
    "Tax Total": data["transaction_tax_amount"],
    "Transaction Total": data["transaction_total_amount"],
    "": "",
    "": ""
}
)

json_data = json.dumps(data1)  # converts to json from Dict

df = pd.read_json(json_data)
# print(df.columns)
df.columns = df.columns.str.replace(',', '|')

df.to_csv('Ftpfile17.csv', sep='|', index=False)
print(df)
