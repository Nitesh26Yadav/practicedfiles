import requests
import os


# conn = "https://0ry7jslpr3.execute-api.us-east-1.amazonaws.com/dev/rule"
conn = os.environ.get("API")
guid = 'F36DF97E-F80C-44C1-A64F-6BE5D07FD298'
UID = 1
# query = f"exec ap_get_rule {guid}, {UID}"




# filterdata = []
# for x in query.split():
# 	if x == 'exec':
# 		pass
# 	elif x != 'exec':
# 		filterdata.append(x)
# proc_name = filterdata[0]
# data = filterdata[1:]

# args_name = str(data).replace('[','').replace(']','')
# print(args_name)


# query = "exec ap_get_rule_stores 1"
# query = f"exec ap_get_rule 'F36DF97E-F80C-44C1-A64F-6BE5D07FD298',1"
# print(query)
# query = "exec ap_get_rule F36DF97E-F80C-44C1-A64F-6BE5D07FD298 eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJVc2VySUQiOjEwMSwiaXNfY29uc2VudF9wcm92aWRlZCI6dHJ1ZSwidXNlcm5hbWUiOiJkZW1vdXNlckBhdXRvcGlsb3QuY29tIiwidXNlcl9ndWlkIjoiN0UyOTExMDUtRDQyNy00QTRDLThGOEMtMUE5MUFCOUY3QTMzIiwiZmlyc3RfbmFtZSI6IkpvaG4iLCJsYXN0X25hbWUiOiJGYXJtcyIsInJldGFpbGVyIjp7ImlkIjo0OCwic2NvcGVzIjpbXX0sImV4cGlyZXNfaW4iOiIyMDIyLTAzLTA1IDE4OjQ3OjIzLjQyMjI2MCJ9.EhC9HR6vgi0dqmD24TpDpe4FEee1VT4p311zHACDk8k"
# query =  f"exec ap_get_rule '{guid}',{UID}"

# query = "exec ap_update_rule_departments"

# query = "exec ap_update_rule_offer 0 "
# # query = "exec ap_update_rule ''
query = "exec ap_get_rule_top_n_shoppers 0"

# print(type("'F36DF97E-F80C-44C1-A64F-6BE5D07FD298',1"))

def Accessdbdata(conn,query):  

	try:
		filterdata = []
		for x in query.split():
			if x == 'exec':
				pass
			elif x != 'exec':
				filterdata.append(x)
		proc_name = filterdata[0]
		# print(proc_name)
		data = filterdata[1:]
		# print(data)

		name = ""
		args_name = name.join(data)
		# print(args_name)
		body = {

		"Instance":"veritra",

		"DB":"RSA_CentMark",

		"Proc": proc_name,

		"Args": args_name
	
		}
		response = requests.post(conn,json = body)
		# print(proc_name)
		# print(args_name)

		rules = response.json()
		return rules['Message']

	except:
		return False

data = Accessdbdata(conn,query)
print(data)





		# "Instance":"veritra",

		# "DB":"RSA_CentMark",

		# "Proc":"ap_get_rule",

		# "Args":"F36DF97E-F80C-44C1-A64F-6BE5D07FD298, eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJVc2VySUQiOjEwMSwiaXNfY29uc2VudF9wcm92aWRlZCI6dHJ1ZSwidXNlcm5hbWUiOiJkZW1vdXNlckBhdXRvcGlsb3QuY29tIiwidXNlcl9ndWlkIjoiN0UyOTExMDUtRDQyNy00QTRDLThGOEMtMUE5MUFCOUY3QTMzIiwiZmlyc3RfbmFtZSI6IkpvaG4iLCJsYXN0X25hbWUiOiJGYXJtcyIsInJldGFpbGVyIjp7ImlkIjo0OCwic2NvcGVzIjpbXX0sImV4cGlyZXNfaW4iOiIyMDIyLTAzLTA1IDE4OjQ3OjIzLjQyMjI2MCJ9.EhC9HR6vgi0dqmD24TpDpe4FEee1VT4p311zHACDk8k".split(',')



# response = requests.post(conn,json={

#     "Instance":"veritra",

#     "DB":"RSA_CentMark",

#     "Proc":"ap_get_rule_top_n_shoppers",

#     "Args":"0"

# })



# filterdata = ""

# for x in query.split():
# 	if x == 'exec':
# 		pass
# 	elif x != 'exec':
# 		filterdata = filterdata +" "+ str(x)

# data = filterdata.replace(' ',',')
# data1 = data.strip(",")

# print(data1)



# filterdata = []
# for x in query.split():
# 	if x == 'exec':
# 		pass
# 	elif x != 'exec':
# 		filterdata.append(x)
# proc_name = filterdata[0]
# data = filterdata[1:]
# # print(data)

# args_name = str(data).strip('[,]')

query = f"exec ap_get_rule 'F36DF97E-F80C-44C1-A64F-6BE5D07FD298',1"
filterdata = []
for x in query.split():
	if x == 'exec':
		pass
	elif x != 'exec':
		filterdata.append(x)
proc_name = filterdata[0]
# print(proc_name)
data = filterdata[1:]
# print(data)

args_name = ""
name = args_name.join(data)
print(name)
